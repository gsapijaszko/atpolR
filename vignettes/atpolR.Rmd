---
title: "Introduction to atpolR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to atpolR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: ../inst/REFERENCES.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction
ATPOL grid was developed in late '60s in Institute of Botany at Jagiellonian University in Kraków. The backgrounds and methodology is described in [@zajacAtlasDistributionVascular1978; @zajacZalozeniaMetodyczneAtlasu1978]; for the first time the grid was used in "Distribution atlas of vascular plants in Poland". The extensive mathematical research and GIS implementation was done by Łukasz Komsta and Marek Verey [@komstaRewizjaMatematycznaSiatki2016; @vereyTeoretycznaAnalizaPraktyczne2017]. Algorithms provided by Komsta on [OpenATPOL](https://atpol.sourceforge.io/) are basis for implementation in `atpolR` package.

## Basic usage

* Prepare sample data based on published ATPOL data
* Extend data
* Plot it 

## Functions description
```{r setup}
library(atpolR)
```
Two basic functions `latlon_to_grid()` and `grid_to_latlon()` allows to quickly convert geographical coordinates (given in WGS 84 latitude and longitude degrees) to ATPOL grid and from grid to coordinates respectively.

```{r}
latlon_to_grid(51.01234, 17.23456, 4)
latlon_to_grid(51.01234, 17.23456, 6)
```
The firs two arguments `latlon_to_grid()` function are latitude and longitude respectively. The third argument is the length of returned grid; it might be even number between 2 and 12.

```{r}
grid_to_latlon("CE50")
```
By default `grid_to_latlon()` returns the center of grid square. If you wish to get it's corners, you can pass another 2 arguments to the function, which are X and Y offsets, like:
```{r}
grid_to_latlon("CE50", xoffset = 1, yoffset = 1)
```
for bottom right corner.

ATPOL 10km x 10km and 100km x 100k grids are generated by `atpol10k()` and `atpol100k()` functions respectively. It returns set of simple features geometries with grids as polygons:

```{r}
atpol100k()
```

For 10k grid it returns a centroids as well:
```{r}
atpol10k()
```

Please note, that ATPOL grids are projected in EPSG:2180 coordinate reference system, commonly used in Poland. 

Function `atpol_div(grid, divider)` divides any given `grid` to smaller grids by 2, 4 or 5 as proposed in [@vereyStandaryzacjaZapisuPodzialow2018].

```{r fig:atpol_div, echo = FALSE, message=FALSE, warning=FALSE, results='hide', fig.width = 7, fig.align='center', fig.cap="Division by 2, 4 and 5 with adopted naming convection d, c, p"}
par(mar = c(0, 0, 0, 0))
par(mfrow = c(1, 3))
for (d in c(2, 4, 5)) {
  a <- atpol_div("BE23", d)
  a$centroid <- sf::st_centroid(a$geometry)

  plot(a$geometry)
  a |>
    sf::st_set_geometry("centroid") |>
    subset(select = c("Name", "centroid")) |>
    terra::vect() |>
    terra::text(labels = substr(a$Name,5,7))
  
}
par(mfrow = c(1, 1))
```


```{r fig:boundaryPL, fig.width=6, fig.align='center', fig.cap="Boundary of Poland on ATPOL grid."}
par(mar = c(0, 0, 0, 0))
b <- boundaryPL()
plot(atpol100k()$geometry)
plot(b, col = "red", add = TRUE)
```

## Bibliography
